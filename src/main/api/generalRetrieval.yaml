openapi: 3.0.0
info:
  title: User Events API
  version: 1.0.0
  description: API to retrieve events associated with a user based on their club memberships.

paths:
  /api/users/{userId}/events:
    get:
      summary: Get all events for a user
      description: Returns all events the user is associated with via club memberships.
      tags:
        - Events
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
            format: uuid
          description: UUID of the user
      responses:
        "200":
          description: List of events the user is associated with
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/UserEventSummary"
        "404":
          description: User not found
        "500":
          description: Internal server error

  /api/clubs/analytics:
    get:
      summary: Get analytics for one or more clubs
      description: Retrieve attendance and upcoming task analytics for one or more clubs.
      tags:
        - ClubAnalytics
      parameters:
        - in: query
          name: clubId
          required: true
          schema:
            type: string
            format: uuid
          description: The primary club ID
        - in: query
          name: comparisonClubId
          required: false
          schema:
            type: string
            format: uuid
          description: The comparison club ID (optional)
        - in: query
          name: month
          required: false
          schema:
            type: string
            pattern: "^(0[1-9]|1[0-2])/\\d{4}$"
          description: Month in MM/YYYY format to filter attendanceAveragePoints (e.g. month=09/2025)
      responses:
        "200":
          description: Analytics for the requested clubs
          content:
            application/json:
              schema:
                type: object
                properties:
                  primaryClub:
                    $ref: "#/components/schemas/ClubAnalytics"
                  comparisonClub:
                    oneOf:
                      - $ref: "#/components/schemas/ClubAnalytics"
                      - type: "null"
              examples:
                twoClubsExample:
                  summary: Two clubs, one with and one without an upcoming event
                  value:
                    primaryClub:
                      attendanceAveragePoints:
                        - month: "09/2025"
                          value: 63
                        - month: "10/2025"
                          value: 44
                      attendanceAverageThisMonth: 45
                      upcomingTask:
                        activityId: "b1a6f8fd-4c2f-4f8d-91f2-6d0b2c1a7e90"
                        activityTitle: "Committee Planning Session"
                        completionPercentage: 85
                    comparisonClub:
                      attendanceAveragePoints: []
                      attendanceAverageThisMonth: 0
                      upcomingTask: null
        "400":
          description: Invalid request parameters
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
              example:
                error: "Missing required parameter: clubId"
        "404":
          description: Club not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
              example:
                error: "One or more clubs not found"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
              example:
                error: "Internal server error"

components:
  schemas:
    UserEventSummary:
      type: object
      properties:
        eventId:
          type: string
          format: uuid
        title:
          type: string
      required:
        - eventId
        - title

    ClubAnalytics:
      type: object
      properties:
        attendanceAveragePoints:
          type: array
          items:
            $ref: "#/components/schemas/AttendancePoint"
        attendanceAverageThisWeek:
          type: integer
        upcomingTask:
          oneOf:
            - $ref: "#/components/schemas/UpcomingTask"
            - type: "null"
      required:
        - attendanceAveragePoints
        - attendanceAverageThisWeek
        - upcomingTask

    AttendancePoint:
      type: object
      properties:
        time:
          type: string
          format: date-time
        value:
          type: integer
      required:
        - time
        - value

    UpcomingTask:
      type: object
      properties:
        activityId:
          type: string
          format: uuid
        activityTitle:
          type: string
        completionPercentage:
          type: integer
      required:
        - activityId
        - activityTitle
        - completionPercentage
